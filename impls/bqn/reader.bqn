Reader ← {𝕊 tokens:
  {
    ts ← tokens
    Peek ⇐ {𝕊 ⋄ ⊑ tokens}
    Next ⇐ {𝕊
      t ← ⊑ts
      ts ↩ 1↓ts
      t
    }
  }
}

T ← {𝕊 s:
  {
    0=≠s ? ⟨⟩ ;
    "~@"≡2↑s ? (<"~@") ∾ T 2↓s ;
    ⊑(⊑s)∊" ,"∾@+10 ? T 1↓s ;
    ⊑(⊑s)∊"[]{}()'`~" ? (<≍⊑s) ∾ T 1↓s ;
    ';'=⊑s ?
      o←⟨⟩
      {𝕊
        o ∾↩ ⊑s
        s ↩ 1↓s
        (⊑s) ≠ @+10
      } •_while_⊢1
      (<o) ∾ T s ;
    '"'=⊑s ?
      o‿p‿r ← """"‿1‿1
      {𝕊
        s ↩ 1↓s
        c ← ⊑s
        o ∾↩ c
        q ← p∧c='"'
        {p ? p↩c≠'\' ; p↩1}
        r ↩ 1<≠s
        r∧¬q
      } •_while_⊢1
      {r?@;•Out "unterminated string: "∾o}
      (<o) ∾ T 1↓s ;
    o←⟨⟩
    {𝕊
      o ∾↩ ⊑s
      s ↩ 1↓s
      ¬⊑(⊑s)∊"[]{}()'""`~,; "∾@+10
    } •_while_⊢1
    (<o) ∾ T s
  }
}

T "  ( ,~@,, ""ohai"" )  ; comment" ∾ (@+10) ∾ "(token + 2)"

{
  Tokenize ⇐ T
  Read_str ⇐ Reader∘Tokenize
}
